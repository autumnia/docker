## run 샘플들

### 공통 네트워크 구성
    docker network ls
    docker network create --driver bridge mybridge

### Mysql master
```
    docker run -d -it \
    --name db001 percona:5.7.30 \
    -h db001 \
    -p 3306:3306 \
    --net mybridge --net-alias=db001 \
    -v /d:/data/db/db001/data:/var/lib/mysql \
    -v /d:/data/db/db001/log:/var/log/mysql \
    -v /d:/data/db/db001/conf:/etc/percona-server.conf.d \
    -e MYSQL_ROOT_PASSWORD="root" 

    cd d:\data\db\db001  폴더 내용 확인 

    volume  설정이 되어 있지 않을 경우 컨테이너 내부 접속이 필요함
    그리고 경로를 찾아 가야함
        docker exec -it -uroot db001 /bin/bash
        cd /varlog/mysql/
```

### Mysql slave01
```
    docker run -d -it \
    --name db002 percona:5.7.30 \
    -h db002 \
    -p 3307:3306 \
    --net mybridge --net-alias=db002 \
    -v /d:/data/db/db002/data:/var/lib/mysql \
    -v /d:/data/db/db002/log:/var/log/mysql \
    -v /d:/data/db/db002/conf:/etc/percona-server.conf.d \
    -e MYSQL_ROOT_PASSWORD="root" 

    cd d:\data\db\db002  폴더 내용 확인 

    volume  설정이 되어 있지 않을 경우 컨테이너 내부 접속이 필요함
    그리고 경로를 찾아 가야함
        docker exec -it -uroot db002 /bin/bash
        cd /varlog/mysql/
```

### Mysql slave02
```
    docker run -d -it \
    --name db003 percona:5.7.30 \
    -h db003 \
    -p 3308:3306 \
    --net mybridge --net-alias=db003 \
    -v /d:/data/db/db003/data:/var/lib/mysql \
    -v /d:/data/db/db003/log:/var/log/mysql \
    -v /d:/data/db/db003/conf:/etc/percona-server.conf.d \
    -e MYSQL_ROOT_PASSWORD="root" 

    cd d:\data\db\db003  폴더 내용 확인 

    volume  설정이 되어 있지 않을 경우 컨테이너 내부 접속이 필요함
    그리고 경로를 찾아 가야함
        docker exec -it -uroot db003 /bin/bash
        cd /varlog/mysql/
```

### mysql conf  마스터용
```
/d:/data/confs/db001/mysql.cnf  로 저장 한다. 

[mysqld]
log_bin                     = mysql-bin
binlog_format               = ROW
gtid_mode                   = ON
enforce-gtid-consistency    = true
server-id                   = 100
log_slave_updates
datadir                     = /var/lib/mysql
socket                      = /var/lib/mysql/mysql.sock

# Disabling symbolic-links is recommended to prevent assorted security risks
symbolic-links              = 0

log-error                   = /var/log/mysql/mysqld.log
pid-file                    = /var/run/mysqld/mysqld.pid

report_host                 = db001

[mysqld_safe]
pid-file                    = /var/run/mysqld/mysqld.pid
socket                      = /var/lib/mysql/mysql.sock
nice                        = 0
```

### mysql conf  slave01
```
[mysqld]
log_bin                     = mysql-bin
binlog_format               = ROW
gtid_mode                   = ON
enforce-gtid-consistency    = true
server-id                   = 200
log_slave_updates
datadir                     = /var/lib/mysql
socket                      = /var/lib/mysql/mysql.sock
read_only

# Disabling symbolic-links is recommended to prevent assorted security risks
symbolic-links              = 0

log-error                   = /var/log/mysql/mysqld.log
pid-file                    = /var/run/mysqld/mysqld.pid

report_host                 = db002

[mysqld_safe]
pid-file                    = /var/run/mysqld/mysqld.pid
socket                      = /var/lib/mysql/mysql.sock
nice                        = 0
```

### mysql conf  slave02
```
[mysqld]
log_bin                     = mysql-bin
binlog_format               = ROW
gtid_mode                   = ON
enforce-gtid-consistency    = true
server-id                   = 300
log_slave_updates
datadir                     = /var/lib/mysql
socket                      = /var/lib/mysql/mysql.sock
read_only

# Disabling symbolic-links is recommended to prevent assorted security risks
symbolic-links              = 0

log-error                   = /var/log/mysql/mysqld.log
pid-file                    = /var/run/mysqld/mysqld.pid

report_host                 = db003

[mysqld_safe]
pid-file                    = /var/run/mysqld/mysqld.pid
socket                      = /var/lib/mysql/mysql.sock
nice                        = 0
```

## 컨테이너 확인
```
    docker ps --format "table {{.ID}} \t {{.Names}} \t {{.Status}} "
```


## 복제 구성
```
    마스터에 복제 계정 및 권한 생성
        docker exec -it -uroot db001 /bin/bash

        ifconfig로 IP 확인 ( 네트워크 생성 하여 필요 없음 )
            예) 172.17.0.2
        
        mysql -uroot -p
            create user 'repl'@'%' Identified by 'repl';
            grant replication slave on *.* to 'repl'@'%';

    db002 설정
        docker exec -it -uroot db002 /bin/bash
        
        mysql -uroot -p
        reset master;
        change master to master_host='db001', \
        master_user='repl', MASTER_PASSWORD='repl', \
        master_auto_positon=1;

        start slave;
        show slave status\G

    db003 설정
        docker exec -it -uroot db003 /bin/bash
        
        mysql -uroot -p
        reset master;
        change master to master_host='db001', \
        master_user='repl', MASTER_PASSWORD='repl', \
        master_auto_positon=1;

        start slave;
        show slave status\G

        



```