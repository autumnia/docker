
``` mysql 백업 및 복구

    기존 서비스 중지


    새로 생성
    docker run -it --name db001 -h db001 -p 3306:3306 \
    --net mybridge --net-alias=db001 \
    -v d:\data\db\db001\data:/var/lib/mysql \
    -v d:\data\db\db001\log:/var/log/mysql \
    -v d:\data\db\db001\conf:/etc/percona-server.conf.d \
    -e MYSQL_ROOT_PASSWORD="root" \
    -d autumnia/mysql57:0.0          

    docker run -it --name db002 -h db002 -p 3306:3306 \
    --net mybridge --net-alias=db002 \
    -v d:\data\db\db002\data:/var/lib/mysql \
    -v d:\data\db\db002\log:/var/log/mysql \
    -v d:\data\db\db002\conf:/etc/percona-server.conf.d \
    -e MYSQL_ROOT_PASSWORD="root" \
    -d autumnia/mysql57:0.0   

    docker exec -it -uroot db001 /bin/bash
    mysql -uyroot -percona

    데이터 생성 테스트
    create database test default character set= utf8;
    use test;
    create table t ( id int primary key );
    insert into t values(1), (2), (3);
    select * from t;
     

    docker hosts 에 pigz package 설치
    yum install -y pigz.x86_64

    백업 디렉토리 생성 및 백업
        mkdir -p /tmp/backup


        docker run --rm --name percona-xtrabackup-2.4 -p 3307 \
        --volumes-from db002 \
        percona/percona-xtrabackup:2.4 \
        xtrabackup --backup --data-dir=/var/lib/mysql \
        --user=root --password=root 
        --stream=xbstream --slave-info |
        pigz -c > /tmp/backup/db002.xbstream.gz


        ls /tmp/backup/


    복구
        yum install -y libaio.x86_64 \
            libev.x86_64 \
            perl-DBD-MySQL.x86_64 \
            perl-Digest-MD5.x86_64 \
            rsync.x86_64


        xtrabackup package download
        https://www.percona.com/downloads/Percona-xtraBackup-2.4/LATEST/

        rpm -ivh percona-xtrabackup-24-2.4.20-1.e17.X86_64.rpm

        복구할 디렉토리 생성
            mkdir -p /db/db003/data  /db/db003/log /db/db003/conf
            cp /db/db002/conf/my.cnf /db/db003/conf
            server-id 와 report_host 변경

            unpigz /tmp/backup/db002.xbstream.gz
            cd /db/db003/data
            xbstream -x < /tmp/backup/db002.xbstream

            xtrabackup --prepare --target-dir=/db/db003/data
            chown -R mysql:mysql data

            db003 container 실행
            docker run -it --name db003 -h db003 -p 3309:3306 \
            --net mybridge --net-alias=db003 \
            -v d:\data\db\db003\data:/var/lib/mysql \
            -v d:\data\db\db003\log:/var/log/mysql \
            -v d:\data\db\db003\conf:/etc/percona-server.conf.d \
            -e MYSQL_ROOT_PASSWORD="root" \
            -d autumnia/mysql57:0.0

            binlog에서 gtid 정보 화인
            cat /db/db003/data/xtrabackup_binlog_info
            mysql-bin.000001 397  {{gtid}}:1

            replication 설정
            docker exec -it -uroot db003 /bin/bash
            mysql -uroot -p 
















